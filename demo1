import { getUsers } from './testing';

// Importing wretch directly into the test file
import wretch from 'wretch';

// Mocking the wretch module
jest.mock('wretch');

describe('API Testing', () => {
    test('getUsers - success', async () => {
        const mockResponse = {
            userId: 1,
            id: 1,
            title: "delectus aut autem",
            completed: false
        };

        // Mocking the wretch instance to return a mock function for get
        const wretchMock = jest.fn();
        wretchMock.mockResolvedValueOnce({ json: jest.fn().mockResolvedValueOnce(mockResponse) });
        (wretch as jest.Mock).mockReturnValueOnce(wretchMock);

        const users = await getUsers();
        expect(users).toEqual(mockResponse);
    });

    test('getUsers - failure', async () => {
        // Mocking the wretch instance to return a mock function for get
        const wretchMock = jest.fn();
        wretchMock.mockRejectedValueOnce(new Error('Network error'));
        (wretch as jest.Mock).mockReturnValueOnce(wretchMock);

        await expect(getUsers()).rejects.toThrow('Failed to fetch users');
    });
});

import { getUsers } from './testing';

// Importing wretch directly into the test file
import wretch from 'wretch';

// Mocking the wretch module
jest.mock('wretch');

describe('API Testing', () => {
    test('getUsers - success', async () => {
        const mockResponse = {
            userId: 1,
            id: 1,
            title: "delectus aut autem",
            completed: false
        };

        // Mocking the wretch.get().json() chain to return the mockResponse
        (wretch().get as jest.Mock).mockResolvedValueOnce({ json: jest.fn().mockResolvedValueOnce(mockResponse) });

        const users = await getUsers();
        expect(users).toEqual(mockResponse);
    });

    test('getUsers - failure', async () => {
        // Mocking the wretch.get().json() chain to reject with an error
        (wretch().get as jest.Mock).mockRejectedValueOnce(new Error('Network error'));

        await expect(getUsers()).rejects.toThrow('Failed to fetch users');
    });
});
